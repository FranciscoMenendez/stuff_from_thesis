# set working directorysetwd('../Cd_treatment_exp/')trt <- read.csv('plant_number_lvl.csv')trt <- data.table(trt)trt[,bioreps := paste(Tray, lvl, sep='')]trt[, .(plants = paste(Plant, collapse = ', '), .N), .(bioreps)]# functionread_licor_mean <- function(file_name, date, alle=F){  dt <- read.csv(file_name)  dt <- dt[2:nrow(dt), ]  dt <- data.table(dt)  dt[, code := paste(plant.number, positon, Cd.level, sep='')]  dt[, bioreps := paste(positon, Cd.level, sep='')]      dt[, .(plants = paste(plant.number, collapse = ", "),             count = .N),          by = bioreps]    trt[match(dt[, plant.number], Plant), .(Plant, lvl)]    dt[match(trt[, Plant], plant.number),]    print(data.frame(correct_lvl=trt[match(dt[, plant.number], Plant), lvl],              correct_plant=trt[match(dt[, plant.number], Plant), Plant],             written_lvl=dt$Cd.level,              written_plant=dt$plant.number))    #corrected treatment level    dt$Cd.level <- trt[match(dt[, plant.number], Plant), lvl]  dt$positon <- trt[match(dt[, plant.number], Plant), Tray]    dt[, code := paste(plant.number, positon, Cd.level, sep='')]  dt[, bioreps := paste(positon, Cd.level, sep='')]  dt[, .(plants = paste(plant.number, collapse = ", "),             count = .N),          by = bioreps]    # AVERAGE BY PLANT CODE   #Each plant should have one observation, per data policy we will keep the   #average between repeat measurements    dt[, .N, .(code)]    dt[, 9:(ncol(dt)-2) := lapply(.SD, as.numeric), .SDcols = 9:(ncol(dt)-2)]    dt[, photo_m := mean(Photo), .(code)]  dt[, cond_m := mean(Cond), .(code)]  dt[, ci_m := mean(Ci), .(code)]  dt[, wue := photo_m/cond_m]  dt[, vpdl_m := mean(VpdL), .(code)]  dt[, rhs_m := mean(RH_S), .(code)]  dt[, tleaf_m := mean(Tleaf), .(code)]  dt[, tair_m := mean(Tair), .(code)]  dt[, rh_r_m := mean(RH_R), .(code)]  dt[, pari_m :=mean(PARi), .(code)]  dt[, ci_photo := photo_m/ci_m, .(code)]  dt[, ci_cond := cond_m/ci_m, .(code)]      #dt[, Cd.level := factor(Cd.level, levels = c('0', '10', '20'), ordered = T)]  #dt[, Tray := factor(positon, levels = c('A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'), ordered = T)]    # Split the time into hours, minutes, and seconds  dt[, c("hours", "minutes", "seconds") := tstrsplit(HHMMSS, ":", type.convert = TRUE)]    # Convert hours and minutes to seconds and add them up  dt[, secondsOD := hours * 3600 + minutes * 60 + seconds]    dt[secondsOD<20000, 'secondsOD'] <- dt[ secondsOD<20000, 'secondsOD']+(12*3600)    dt[, hours := as.numeric(hours)]  dt[, minutes := as.numeric(minutes)]  dt[, secondsOD := as.numeric(secondsOD)]    dt[, hours := mean(hours), .(code)]  dt[, minutes := mean(minutes), .(code)]  dt[, secondsOD := mean(secondsOD), .(code)]    #convert to factors Cd.level    dt$Cd.level <- factor(dt$Cd.level)    if (alle==T){    dt <- unique(dt[, .(code, hours, minutes, secondsOD, positon, plant.number, Cd.level, photo_m, cond_m, wue, ci_m, ci_photo, ci_cond, vpdl_m, rhs_m, tleaf_m, tair_m, rh_r_m, pari_m)]) # 48 observations  }else{    dt <- unique(dt[, .(code, hours, minutes, secondsOD, positon, plant.number, Cd.level, photo_m, cond_m, wue, ci_m)]) # 48 observations      }      dt$date <- date    return(dt)  }